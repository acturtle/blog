<section>
<p>Actuaries calculate cash flow models on policy data. We want to have the output per each policy or already aggregated.</p>

<p>Let's see how to change the settings to calculate both types of results.</p>

<p>In this tutorial, we will use <a href="https://pypi.org/project/cashflower/" target="_blank">the cashflower package</a>. Cashflower is a python framework for actuarial cash flow models.</p>
</section>

<section>
<p>We will base on the model that we built <a href="https://www.acturtle.com/blog/modelling-multiple-coverages" target="_blank">in this tutorial</a>. It is a whole life model with riders. We will run the model on 3 policies.</p>

<span class="source">policy data</span>
<div class="code">
<pre><codeID,AGE,SEX,PREMIUM
1,32,MALE,140
2,54,FEMALE,130
3,36,MALE,120
</code></pre>
</div>

<br>

<span class="source">coverage data</span>
<div class="code">
<pre><code>ID,SUM_ASSURED,TYPE
1,100000,DEATH
1,30000,ILLNESS
2,200000,DEATH
3,80000,DEATH
3,40000,ILLNESS</code></pre>
</div>

<p>For clarity of results, let's limit the output to the 3 first months.</p>

<span class="source">mult_cov/settings.py</span>
<div class="code">
<pre><code>settings = {
    ...
    "T_OUTPUT_MAX": 3,
    ...
}</code></pre>
</div>

<h2>Individual output</h2>

<p>The aggregation of outputs is configurable using the <code>AGGREGATE</code> setting. By default, the results are <b>not</b> aggregated.</p>

<span class="source">mult_cov/settings.py</span>
<div class="code">
<pre><code>settings = {
    ...
    "AGGREGATE": False,
    ...
}</code></pre>
</div>

<p>Let's run the model (to do that, source the <code>run.py</code> script).</p>

<span class="source">policy output</span>
<a href="/static/img/27/1a.png" target="_blank"><img src="/static/img/27/1a.png"></a>

<br>

<span class="source">coverage output</span><br>
<a href="/static/img/27/1b.png" target="_blank"><img src="/static/img/27/1b.png" width="150"></a>

<p>Results for each of the policies are one under the other.</p>

<p>In the policy output, there are 3 sets of outputs. The coverage output has 5 sets of outputs (1<sup>st</sup> policy has 2 coverages, 2<sup>nd</sup> has 1 and 3<sup>rd</sup> has 2 coverages).</p>

<p>This is a good output to analyze all the results for each policy.</p>

<h2>Aggregated output</h2>

<p>For reporting purposes, we are often interested in the results for the whole portfolio.</p>

<p>Now, let's see what happens if we change the <code>AGGREGATE</code> setting to <code>True</code>.</p>

<span class="source">mult_cov/settings.py</span>
<div class="code">
<pre><code>settings = {
    ...
    "AGGREGATE": True,
    ...
}</code></pre>
</div>

<br>

<span class="source">policy output</span><br>
<a href="/static/img/27/2a.png" target="_blank"><img src="/static/img/27/2a.png"></a>

<br>

<span class="source">coverage output</span><br>
<a href="/static/img/27/2b.png" target="_blank"><img src="/static/img/27/2b.png" width="150"></a>

<p>Observations:</p>
<ul>
  <li>both policy and coverage outputs have only one set of records,</li>
  <li>each result is a sum of all policies and records (e.g. age 122 is the sum of the ages of the three policyholders: 32, 54 and 36),</li>
  <li><code>expected_benefit</code> in policy output equals <code>expected_coverage_benefit</code> in coverage output because the aggregation is across policies and records.</li>
</ul>

<p>We calculated the BEL for the whole portfolio which amounts to â‚¬90k. This value we want to report.</p>

<h3>Output columns</h3>

<p>But many other results don't make sense anymore. For example variables such as age or spot rate have no meaning once aggregated.</p>

<p>When we aggregate results, we should limit the output only to certain columns. These are the columns which can be summed across the whole portfolio.</p>

<p>For this purpose, we can use the <code>OUTPUT_COLUMNS</code> setting. By default, the setting is set to an empty list.</p>

<span class="source">mult_cov/settings.py</span>
<div class="code">
<pre><code>settings = {
    ...
    "OUTPUT_COLUMNS": [],
    ...
}</code></pre>
</div>

<p>Empty list means that the model will output <b>all possible columns</b>.</p>

<p>If you want to narrow down the columns in the output, pass a list of column names.</p>

<span class="source">mult_cov/settings.py</span>
<div class="code">
<pre><code>settings = {
    ...
    "OUTPUT_COLUMNS": [
        "expected_benefit",
        "expected_premium",
        "pv_expected_benefit",
        "pv_expected_premium",
        "best_estimate_liabilities",
        "expected_coverage_benefit",
    ],
    ...
}</code></pre>
</div>

<br>

<span class="source">policy output</span><br>
<img src="/static/img/27/3.png">

<p>Now the output file looks better!</p>
